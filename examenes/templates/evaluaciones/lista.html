{% extends 'base.html' %}
{% load static %}
{% block title %}
Listado principal de evaluaciones de la comunidad
{% endblock title %}
{% block content %}
{% if messages %}
{% for message in messages %}

<div class="alert alert-info m-0 p-2 px-3 " role="alert">
    <div class="container">

        <div class="row d-flex justify-content-between">
            {{message}}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<br>
<br>
<div class="container col-md-12 col-xl-10 border-start">

    <div class="row">
        <div class="col-md-12 col-lg-4 px-3">
            <form method="get">
                <div class="row mb-3 mx-0 px-0">
                    <div class="col-9">
                        <div class="row me-1">
                            <input class="form-control me-1 px-2" value="{{kword}}" type="text" id="kword" name="kword"
                                placeholder="Buscar ...">

                        </div>
                    </div>
                    <div class="col-3">
                        <div class="row">

                            <button class="btn btn-outline-primary" type="submit">Buscar</button>
                        </div>
                    </div>

                </div>
            </form>
            <div class="row d-none d-lg-block">
                <div class="fs-3 mb-2">Categorias</div>
            </div>
            <div class="row mx-0 mb-2 d-none d-lg-block">
                <div class="list-group px-3">

                    {% if cat_sel == "todos" %}
                    <a class="list-group-item list-group-item-action bg-dark text-white" name="categoria" value="todos"
                        href="?kword={{kword}}&categoria=todos">
                        Todos
                    </a>
                    {% else %}
                    <a class="list-group-item list-group-item-action" name="categoria" value="todos"
                        href="?kword={{kword}}&categoria=todos">
                        Todos
                    </a>

                    {% endif %}
                    {% for cat in categorias %}
                    {% if cat_sel == cat.nombre %}
                    <a class="list-group-item list-group-item-action bg-dark text-white" value="{{cat.nombre}}"
                        name="categoria" href="?kword={{kword}}&categoria={{cat.nombre}}">
                        {{cat.nombre}}
                    </a>
                    {% else %}
                    <a class="list-group-item list-group-item-action" name="categoria" value="{{cat.nombre}}"
                        href="?kword={{kword}}&categoria={{cat.nombre}}">
                        {{cat.nombre}}
                    </a>

                    {% endif %}


                    {% endfor %}

                </div>

            </div>
            <div class="row d-none d-lg-block" >
                <div class="fs-3 mb-2">Ordenar por</div>
            </div>
            <div class="row mx-0 mb-2 d-none d-lg-block">
                <div class="list-group px-3">


                    {% if cat_sel == "" %}
                    {% if ord_sel == "populares" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="populares" name="orden"
                        href="?kword={{kword}}&orden=populares">
                        Más populares
                    </a>
                    {% else %}
                    <a class="list-group-item list-group-item-action" value="populares" name="orden"
                        href="?kword={{kword}}&orden=populares">
                        Más populares
                    </a>
                    {% endif %}

                    {% if ord_sel == "valorados" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="valorados" name="orden"
                        id="orden2" href="?kword={{kword}}&orden=valorados">
                        Mejor valorados
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="valorados" name="orden" id="orden2"
                        href="?kword={{kword}}&orden=valorados">
                        Mejor valorados
                    </a>

                    {% endif %}
                    {% if ord_sel == "nuevos" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="nuevos" name="orden"
                        href="?kword={{kword}}&orden=nuevos">
                        Más nuevos
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="nuevos" name="orden"
                        href="?kword={{kword}}&orden=nuevos">
                        Más nuevos
                    </a>

                    {% endif %}
                    {% if ord_sel == "faciles" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="faciles" name="orden"
                        href="?kword={{kword}}&orden=faciles">
                        Más faciles primero
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="faciles" name="orden"
                        href="?kword={{kword}}&orden=faciles">
                        Más faciles primero
                    </a>

                    {% endif %}
                    {% if ord_sel == "dificiles" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="dificiles" name="orden"
                        href="?kword={{kword}}&orden=dificiles">
                        Más dificiles primero
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="dificiles" name="orden"
                        href="?kword={{kword}}&orden=dificiles">
                        Más dificiles primero
                    </a>

                    {% endif %}
                    {% else %}
                    {% if ord_sel == "populares" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="populares" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=populares">
                        Más populares
                    </a>
                    {% else %}
                    <a class="list-group-item list-group-item-action" value="populares" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=populares">
                        Más populares
                    </a>
                    {% endif %}

                    {% if ord_sel == "valorados" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="valorados" name="orden"
                        id="orden2" href="?kword={{kword}}&categoria={{cat_sel}}&orden=valorados">
                        Mejor valorados
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="valorados" name="orden" id="orden2"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=valorados">
                        Mejor valorados
                    </a>

                    {% endif %}
                    {% if ord_sel == "nuevos" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="nuevos" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=nuevos">
                        Más nuevos
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="nuevos" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=nuevos">
                        Más nuevos
                    </a>

                    {% endif %}
                    {% if ord_sel == "faciles" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="faciles" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=faciles">
                        Más faciles primero
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="faciles" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=faciles">
                        Más faciles primero
                    </a>

                    {% endif %}
                    {% if ord_sel == "dificiles" %}

                    <a class="list-group-item list-group-item-action bg-dark text-white" value="dificiles" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=dificiles">
                        Más dificiles primero
                    </a>

                    {% else %}
                    <a class="list-group-item list-group-item-action" value="dificiles" name="orden"
                        href="?kword={{kword}}&categoria={{cat_sel}}&orden=dificiles">
                        Más dificiles primero
                    </a>

                    {% endif %}
                    {% endif %}




                </div>

            </div>
            <div class="row d-none d-lg-block">
                <div class="fs-3 mb-2">Espacio publicitario</div>
            </div>
            <div class="row d-lg-none mb-3">
                <div class="col-6 col-md-3">
                    <div class="btn-group">
                        <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Categorias
                          </button>
                          <ul class="dropdown-menu dropdown-menu-dark">
                            {% if cat_sel == "todos" %}
                            <li><a class="dropdown-item bg-dark text-white" name="categoria" value="todos"
                                href="?kword={{kword}}&categoria=todos">
                                Todos
                            </a></li>
                            {% else %}
                            <li><a class="dropdown-item" name="categoria" value="todos"
                                href="?kword={{kword}}&categoria=todos">
                                Todos
                            </a></li>
        
                            {% endif %}
                            {% for cat in categorias %}
                            {% if cat_sel == cat.nombre %}
                            <li><a class="dropdown-item bg-dark text-white" value="{{cat.nombre}}"
                                name="categoria" href="?kword={{kword}}&categoria={{cat.nombre}}">
                                {{cat.nombre}}
                            </a></li>
                            {% else %}
                            <li><a class="dropdown-item" name="categoria" value="{{cat.nombre}}"
                                href="?kword={{kword}}&categoria={{cat.nombre}}">
                                {{cat.nombre}}
                            </a></li>
        
                            {% endif %}
        
        
                            {% endfor %}
                          </ul>

                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                       
                        <div class="btn-group">
                            <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Ordenar por
                                </button>
                                <ul class="dropdown-menu dropdown-menu-dark">
    
    
                                {% if cat_sel == "" %}
                                {% if ord_sel == "populares" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="populares" name="orden"
                                    href="?kword={{kword}}&orden=populares">
                                    Más populares
                                </a></li>
                                {% else %}
                                <li><a class="dropdown-item" value="populares" name="orden"
                                    href="?kword={{kword}}&orden=populares">
                                    Más populares
                                </a></li>
                                {% endif %}
            
                                {% if ord_sel == "valorados" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="valorados" name="orden"
                                    id="orden2" href="?kword={{kword}}&orden=valorados">
                                    Mejor valorados
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="valorados" name="orden" id="orden2"
                                    href="?kword={{kword}}&orden=valorados">
                                    Mejor valorados
                                </a></li>
            
                                {% endif %}
                                {% if ord_sel == "nuevos" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="nuevos" name="orden"
                                    href="?kword={{kword}}&orden=nuevos">
                                    Más nuevos
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="nuevos" name="orden"
                                    href="?kword={{kword}}&orden=nuevos">
                                    Más nuevos
                                </a></li>
            
                                {% endif %}
                                {% if ord_sel == "faciles" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="faciles" name="orden"
                                    href="?kword={{kword}}&orden=faciles">
                                    Más faciles primero
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="faciles" name="orden"
                                    href="?kword={{kword}}&orden=faciles">
                                    Más faciles primero
                                </a></li>
            
                                {% endif %}
                                {% if ord_sel == "dificiles" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="dificiles" name="orden"
                                    href="?kword={{kword}}&orden=dificiles">
                                    Más dificiles primero
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="dificiles" name="orden"
                                    href="?kword={{kword}}&orden=dificiles">
                                    Más dificiles primero
                                </a></li>
            
                                {% endif %}
                                {% else %}
                                {% if ord_sel == "populares" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="populares" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=populares">
                                    Más populares
                                </a></li>
                                {% else %}
                                <li><a class="dropdown-item" value="populares" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=populares">
                                    Más populares
                                </a></li>
                                {% endif %}
            
                                {% if ord_sel == "valorados" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="valorados" name="orden"
                                    id="orden2" href="?kword={{kword}}&categoria={{cat_sel}}&orden=valorados">
                                    Mejor valorados
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="valorados" name="orden" id="orden2"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=valorados">
                                    Mejor valorados
                                </a></li>
            
                                {% endif %}
                                {% if ord_sel == "nuevos" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="nuevos" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=nuevos">
                                    Más nuevos
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="nuevos" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=nuevos">
                                    Más nuevos
                                </a></li>
            
                                {% endif %}
                                {% if ord_sel == "faciles" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="faciles" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=faciles">
                                    Más faciles primero
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="faciles" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=faciles">
                                    Más faciles primero
                                </a></li>
            
                                {% endif %}
                                {% if ord_sel == "dificiles" %}
            
                                <li><a class="dropdown-item bg-dark text-white" value="dificiles" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=dificiles">
                                    Más dificiles primero
                                </a></li>
            
                                {% else %}
                                <li><a class="dropdown-item" value="dificiles" name="orden"
                                    href="?kword={{kword}}&categoria={{cat_sel}}&orden=dificiles">
                                    Más dificiles primero
                                </a></li>
            
                                {% endif %}
                                {% endif %}
            
            
            
            
                            </ul>

                        </div>

                        
                    </div>
                
            </div>


        </div>
        <div class="container col-md-12 col-lg-8">
            <div class="row">
                {% if kword %}
                <h3 class="text-primary">Busqueda por palabra clave: {{kword}}</h3>
                {% endif %}
            </div>
            <div class="row align-items-center mb-2">
                <div class="col-md-9">
                    <h2 class="text-secondary fw-light mb-2 fs-3">Mostrando {{ page_obj.start_index }}-{{ page_obj.end_index }} de {{ page_obj.paginator.count }} evaluaciones</h2>
                </div>


            </div>

            {% for e in evaluaciones %}
            <div class="row border border-1 rounded mb-3 p-2 align-items-center shadow">
                <a class="col-xl-2 px-0 d-none d-xl-block" href="{% url 'exams_app:detalleeva' e.slug %}">
                    {% if e.imagen %}
                    <img class="w-100 d-block rounded" src="{{e.imagen.url}}" alt="">
                    {% else %}

                    <img class="w-100 d-block rounded" src="/static/img/subcats/{{e.subcategoria.nombre}}.jpg" alt="">

                    {% endif %}
                </a>
                <div class="col-12 col-xl-10">
                    <div class="row mb-2 justify-content-center align-items-center">
                        <a class="col-8  col-sm-3 px-0 d-xl-none" href="{% url 'exams_app:detalleeva' e.slug %}">
                            {% if e.imagen %}
                            <img class="w-100 d-block rounded" src="{{e.imagen.url}}" alt="" style="max-height: 150px;">
                            {% else %}

                            <img class="w-100 d-block rounded" src="/static/img/subcats/{{e.subcategoria.nombre}}.jpg"
                                alt="" style="max-height: 150px;">

                            {% endif %}
                        </a>
                        <div class="col-12 col-sm-9 text-center text-sm-start mt-1">
                            <a class="fs-4 fw-light text-decoration-none lh-sm"
                                href="{% url 'exams_app:detalleeva' e.slug %}">{{e.nombre}}</a>
                            <div class="row text-start">
                                <div class="col-xl-6 col-md-12 fs-6 fw-light text-secondary">Categoría:
                                    {{e.subcategoria.categoria}}</div>
                                <div class="col-xl-6 col-md-12 fs-6 fw-light text-secondary">Subcategoría:
                                    {{e.subcategoria}}</div>
                            </div>
                        </div>
                        <div class="col-12 col-xl-3">
                            <div class="row text-center justify-content-end mx-0"
                                style="font-size: 0.8rem;">

                                <div class="col-4 col-sm-2 col-xl-6 me-1 me-xl-0 border rounded">
                                    {{e.favoritos}} <i class="fas fa-users"></i>
                                </div>
                                <div class="col-4 col-sm-2 col-xl-6 mx-0 border rounded">
                                    {{e.valoracion|floatformat:2}} <i class="fas fa-star-half-alt"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 container border rounded px-0 ">
                        <div class="row text-center align-items-center border-bottom letrapeque mx-0 px-0 fw-light" >
                            <div class="col px-0">
                                Cantidad preguntas
                            </div>
                            <div class="col px-0">
                                Puntaje minimo
                            </div>
                            <div class="col px-0">
                                Intentos permitidos
                            </div>
                            <div class="col px-0">
                                Tiempo Limite
                            </div>
                            <div class="col px-0">
                                Dificultad
                            </div>
                        </div>
                        <div class="row text-center py-1 mx-0 letrapeque" >
                            <div class="col px-0">
                                {{e.cant_preguntas}}
                            </div>
                            <div class="col px-0">
                                {{e.puntaje_minimo}} / 100
                            </div>
                            <div class="col px-0">
                                {{e.intentos_permitidos}}
                            </div>
                            <div class="col px-0">
                                {{e.tiempo_limite}} mins
                            </div>


                            {% if e.dificultad_ponderada > 7 %}

                            <div class="col text-danger px-0  fw-bold">
                                {{e.dificultad_ponderada|floatformat:2}}
                            </div>
                            {% elif e.dificultad_ponderada > 4 %}
                            <div class="col text-primary px-0 fw-bold">
                                {{e.dificultad_ponderada|floatformat:2}}
                            </div>
                            {% else %}
                            <div class="col text-success fw-bold">
                                {{e.dificultad_ponderada|floatformat:2}}
                            </div>

                            {% endif %}
                        </div>

                    </div>
                </div>


            </div>

            {% endfor %}
            {% include 'paginacion_eva.html' %}
        </div>

    </div>


</div>




{% endblock content %}